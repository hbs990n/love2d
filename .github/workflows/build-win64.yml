name: Final Build
on: workflow_dispatch

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Get source
        run: |
          git clone https://github.com/love2d/megasource.git
          git clone https://github.com/${{ github.repository }}.git megasource/libs/love
      
      - name: Build
        run: |
          cd megasource
          cmake -B build -S .
          cmake --build build --config Release
      
      - name: Find exe
        run: |
          mkdir output
          $exe = Get-ChildItem -Path megasource -Recurse -Filter "love.exe" -File | Select-Object -First 1
          if ($exe) {
            Copy-Item $exe.FullName output/love.exe
            echo "Found: $($exe.FullName)"
          }
      
      - uses: actions/upload-artifact@v4
        with:
          name: love-final
          path: output/
